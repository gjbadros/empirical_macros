\documentstyle[11pt,epsf]{article}

\marginparwidth 0pt
\oddsidemargin  0pt
\evensidemargin 0pt
\marginparsep 0pt

\topmargin   0pt

\textwidth   6.5 in
\textheight  8.5 in

\begin{document}
\bibliographystyle{plain}

\title{An Empirical Analysis of the Use of the C Preprocessor}

\author{Michael Ernst,\thanks{Email 
addresses: {\tt \{mernst, gjb, notkin\}@cs.washington.edu}.  Contact author:
mernst@cs.washington.edu.}
\and Greg J. Badros \and David Notkin}


\date{Department of Computer
Science and Engineering
\\University 
of Washington\\
Box 352350\\
Seattle, WA  98195-2350\\
\today}  

\maketitle


\begin{abstract}

The C programming language is intimately connected to its macro
preprocessor.  This relationship affects the tools (compilers,
debuggers, call graph extractors, etc.) built to engineer C programs,
and it affects the ease of translation to other languages such as C++.
In this paper we analyze over 20 packages comprising 1.5 million lines
of C code from the GNU distribution, determining the ways in which the
preprocessor is used in practice.  We developed a framework for
analyzing preprocessor usage, using it to extract information
including: the percentage of preprocessor directives in C programs,
about the frequency of use of defined macros, about the relationship
between C functions and their use of macros, and about the macros that
could not be easily replaced in a conversion to a language such as
C++.  We report on the analysis, in particular illustrating data that
are material when considering the definition of tools for C or
translators to C++.  

\end{abstract}

\bigskip

\section{Introduction}

The C programming language~\cite{kr,ansi} is intimately connected to
its macro preprocessor [any cites?].  That is, nobody writes programs
in ``pure'' C; facilities of the preprocessor such as including other
files, defining constants and macros, conditional compilation,
etc. are present in essentially every program.  This relationship
between the C language and the preprocessor has a number of
consequences, many of which were probably not anticipated by the
original designers.  

[Includes motivation, how we ran the ``experiment'', etc.]

\section{Related Work}\label{sec:related}

\section{Gathering and Analyzing the Data}\label{sec:gathering}

A number of our analyses refer to the ``number of lines'' in a
program.  We distinguish three ways of counting lines:
\begin{itemize}

\item {\em Physical} lines refers to the actual numbers of lines in
the file; in Unix terms, this is the number of newline characters plus
one.  

\item {\em Logical} lines merges lines logically continued onto the
next physical line using a continuation character.  This count is at
most as large at the physical line count. [Question: I'm assuming that
you do this for the lines that the preprocessor eats and those that
the C compiler ultimately gets.]

\item {\em Non-comment/Non-blank (NCNB)} lines eliminates any lines
that contain only comments or that are blank lines (consisting only of
whitespace).  [Question: Again, I'm assuming this holds across all
lines in the file.]

\end{itemize}

\section{Occurrence of Preprocessor Directives}\label{sec:directives}

The first question we asked was a simple one: how often do
preprocessor directives appear in C programs?
Figure~\ref{fig:gzip_directives} shows the data for the gzip package.
The top bars shows the percentage of lines (split into the three
categories discussed above) coming from all preprocessor directives;
the remaining bars show the percentages of each specific directive as
labeled.  (The \verb+#endif+ directive has been eliminated since it is
the sum of the \verb+#if#+, \verb+#ifdef#+ and \verb+#ifndef#+ directives;
the line counts were also reduced by this amount.)

Perhaps the most surprising information here is the percentage of the
program lines that are preprocessor directives: under any of our
interpretations of lines, at least 11\% of the program consists of
preprocessor directives.  Of these, about half are \verb+#define#
directives.  [We'll want to insert a breakdown of what kinds of
defines these are.]

[This will be I and II.]

\section{Frequency of Defined Macro Usage}\label{sec:usage}

[This will be III, IIIa, and IIIb,]

\section{Categorization}\label{sec:categorization}

[I'm not entirely sure about this; it might be just IV (evil or
essential macros and related issues) or it might also include Mike's
manual breakdown into categories for gzip.]

\section{Discussion}\label{sec:discussion}

[Includes discussion of the analyses, brief discussion of the
``framework'', etc.]

\section{Conclusion}\label{sec:conclusion}

\small \bibliography{evil}


\end{document}

